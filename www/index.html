<!doctype html>
<html lang="en">
 <head>
  <title>Connecting...</title>
  <script src="js/jquery.min.js"></script>
  <link rel="stylesheet" href="css/crt.css"/>
  <link rel="license" href="/doc/LICENSE"/>
  <meta charset="utf-8">
  <meta name="author" content="rustyaxe"/>
  <meta name="description" content="dialup intro"/>
  <meta name="viewport" content="width=device-width; initial-scale=1"/>
 </head>
 <body>
  <script>
  $(document).ready(function() {
    (function($){$.fn.typeWrite=function(s){
        var o={content:$(this).text(),delay:40,t:this,i:0};
        if(s){$.extend(o,s);}o.t.text('');
        var i=setInterval(function() {
            o.t.text(o.t.text()+o.content.charAt(o.i++));    
            if(o.i==o.content.length){clearInterval(i);}}
        ,o.delay);
      return o.t;  
    };})(jQuery);

    // Allow user to skip annoying retro intro ;)
    var SkippedIntro = false;

    function skipIntro() {
        SkippedIntro = true;

        if (typeof audio !== 'undefined') {
           audio.stop();
        }

        // Hide the skipIntro button & note...
        $('span#skipIntro').hide();
        // Hide all the bits of the dialup process
        window.location.href = 'menu.html';
    };

    /* ESCape - SKIP intro */
    $(document).keydown(function(event) {
       if (event.keyCode == 27) {
           if (!SkippedIntro) {
              SkippedIntro = true;
              skipIntro();
              // Stop processing this event (don't send it lower) */
              event.preventDefault();
           }
       }
    });

    function checkCookie(cookieName) {
        return document.cookie.split(';').some((item) => item.trim().startsWith(cookieName + '='));
    }

    // Function to set a cookie
    function setCookie(cookieName, cookieValue, expiryDays) {
        const date = new Date();
        date.setTime(date.getTime() + (expiryDays * 24 * 60 * 60 * 1000));
        const expires = "expires=" + date.toUTCString();
        document.cookie = cookieName + '=' + cookieValue + ';' + expires + ';path=/';
    }

    // Function to call when skipping intro
    function skipIntro() {
        // Your skipIntro logic goes here
        console.log("Intro skipped!");
    }

    // Check if the cookie exists
    if (checkCookie('introSeen')) {
        skipIntro();
    } else {
        // Set the cookie
        setCookie('introSeen', 'true', 30); // Cookie expires in 30 days
        // Your code to run if the cookie doesn't exist goes here
        console.log("Intro shown for the first time!");
        $('#play').on('click', function() {
             var audio = new Audio("audio/dialup.ogg");
             $(this).hide(0);
             audio.currentTime = 0;

             $('#skipIntro').click(function() { skipIntro(); });

             // Begin the show!
             $('#dialup1').show();
             $('#local').typeWrite({content: "picocom /dev/ttyS0"});

             setTimeout(function() {
                $('#local2').show("fast");

                setTimeout(function() {
                   if (!SkippedIntro) {
                      $('#dialup2').show("fast");
                      $('#dialup2').typeWrite({content: "+++ATZ"});
                   }
                 }, 500);
             }, 1000);

             setTimeout(function() {
                if (!SkippedIntro) {
                   $('#dialup3').show("fast");
                   setTimeout(function() {
                     $('#dialup5').show("fast");
                     $('#dialup6').show("slow");
                     $('#dialup6').typeWrite({content:'ATDT15702340003'});
                     setTimeout(function() {
                       audio.play();
                     }, 705);
                   }, 500);
                }
              }, 2150);

             audio.addEventListener("ended", function() {
                 if (!SkippedIntro)  {
                    $('#dialup7').show("fast");
                    setTimeout(function() {
                             $('#shell1').show();
                             $('#shell2').show();
                    }, 750);
                    
                    setTimeout(function() {
                             $('#shell3').show();
                             $('#shell3').typeWrite({ content: "rtm/jklwest"});
                    }, 2500);

                    setTimeout(function() {
                             $('#shell4').show("fast");
                    }, 4100);

                    setTimeout(function() {
                      $('#shell5').show("fast");
                      setTimeout(function() {
                         skipIntro();
                      }, 10000);
                    }, 5120);
                 }
             });
         });
      }
    });
  </script>
  <div id="wrappedcontent" class="ow_scanline">
   <input type="button" id="play" value="Click to play"/>
   <div id="skipIntro">Click here or Press ESC to Skip Intro</div>
   <div id="dialup1">
     fsckit<green>@</green>toaster<green>:</green>~<red>&gt; </red><span id="local"></span><br/>
     <span id="local2">Opened /dev/ttyS0 at 115200bps</span>
    </div>
    <div id="dialup2"></div>
    <div id="dialup3"></div>
    <div id="dialup4"></div>
    <div id="dialup5">OK</div>
    <div id="dialup6"></div>
    <div id="dialup7">CONNECT 57600</div>
    <div id="shell1">
     <pre>
     Security check OK, allowing caller.

     Thank you for calling The Underground!
          
     We do not recognize the line you are calling from, please login...
     </pre>
    <br/><br/>
    </div>
    <span id="shell2">Login:</span>
    <span id="shell3"></span><br/>
    <span id="shell4">Password:</span><br/>
    <div id="shell5"><br/>Welcome back, jklwest! You have new mail.</div>
   </div>
  </div>
 </body>
</html>
